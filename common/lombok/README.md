[Вернуться к оглавлению](https://github.com/engine-it-in/different-level-task/blob/main/README.md)
***
- [Lombok](#lombok)
  - [Что может генерировать](#что-может-генерировать)
  - [@Log](#log)
  - [@Cleanup](#cleanup)
  - [Что сожет пойти не так при использовании с JPA](#что-может-пойти-не-так-при-использовании-с-jpa)
***
# Lombok

Lombok используется для упрощения кода Java, позволяя автоматически генерировать шаблонный код, такой как геттеры,
сеттеры, конструкторы и другие методы, что уменьшает количество шаблонного кода, который разработчики должны писать и
поддерживать.

## Что может генерировать

| Аннотация                  | Описание                                                                                                                                            |
|----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| `@Getter`                  | Автоматически генерирует геттеры для всех полей класса или отдельного поля.                                                                         |
| `@Setter`                  | Автоматически генерирует сеттеры для всех не final полей класса или отдельного поля.                                                                |
| `@NoArgsConstructor`       | Генерирует конструктор без аргументов.                                                                                                              |
| `@AllArgsConstructor`      | Генерирует конструктор со всеми аргументами для каждого поля класса.                                                                                |
| `@RequiredArgsConstructor` | Генерирует конструктор с одним аргументом для каждого final поля или поля, помеченного `@NonNull`, которое не инициализировано в момент объявления. |
| `@Data`                    | Комбинирует `@Getter`, `@Setter`, `@RequiredArgsConstructor`, `@ToString` и `@EqualsAndHashCode`.                                                   |
| `@Builder`                 | Предоставляет паттерн Builder для класса.                                                                                                           |
| `@ToString`                | Генерирует реализацию метода `toString()` для класса.                                                                                               |
| `@EqualsAndHashCode`       | Генерирует реализации методов `equals(Object other)` и `hashCode()`.                                                                                |
| `@Value`                   | Создает неизменяемый класс, эквивалентен объявлению `@Data` с final полями.                                                                         |
| `@SneakyThrows`            | Позволяет скрыть проверяемые исключения без объявления их в сигнатуре метода.                                                                       |
| `@Log`*                    | Создает логгер в вашем классе (есть вариации для разных библиотек логирования, такие как `@Slf4j`, `@Log4j`, `@Log4j2`).                            |
| `@NonNull`                 | Помечает поле как ненулевое и генерирует соответствующую проверку в генерируемом конструкторе.                                                      |
| `@Cleanup`                 | Гарантирует вызов метода `close()` на ресурсе в блоке `finally`, что полезно для работы с ресурсами, требующими закрытия.                           |
| `@Delegate`                | Делегирует реализацию методов интерфейса другому полю.                                                                                              |
| `@SuperBuilder`            | Как `@Builder`, но также позволяет работать с наследованием.                                                                                        |
| `@With`                    | Генерирует методы `withAttributeName(value)` для обновления значений полей в неизменяемых объектах.                                                 |

## @Log

| Аннотация | Библиотека логирования | Описание                                                                                                                                                                                                                                                                  |
|-----------|------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `@Log`    | java.util.logging      | Генерирует статическое поле `log` в вашем классе, которое является экземпляром `java.util.logging.Logger`. Позволяет логировать сообщения, используя встроенный в Java механизм логирования.                                                                              |
| `@Slf4j`  | SLF4J                  | Создает статическое поле `log` типа `org.slf4j.Logger`. SLF4J (Simple Logging Facade for Java) предоставляет абстракцию для различных библиотек логирования, таких как logback, log4j и других. Это позволяет легко переключаться между разными реализациями логирования. |
| `@Log4j`  | Log4j 1.x              | Генерирует статическое поле `log` типа `org.apache.log4j.Logger`. Log4j 1.x — это старая версия популярной библиотеки логирования для Java, которая позволяет логировать сообщения с различным уровнем важности.                                                          |
| `@Log4j2` | Log4j 2.x              | Генерирует статическое поле `log` типа `org.apache.logging.log4j.Logger`. Log4j 2.x — это современная версия библиотеки Log4j, которая предоставляет улучшенную производительность и гибкость по сравнению с предыдущей версией.                                          |

## @Cleanup

В этом примере аннотация `@Cleanup` применяется к переменным `in` и `out`, которые являются потоками ввода и вывода
соответственно. Lombok гарантирует, что метод `close()` будет вызван для `in` и `out` в блоке `finally`, что
предотвратит утечки ресурсов, даже если во время чтения или записи произойдет исключение.

```java
import lombok.Cleanup;

import java.io.*;

public class Example {
    public static void main(String[] args) {
        @Cleanup InputStream in = new FileInputStream("input.txt");
        @Cleanup OutputStream out = new FileOutputStream("output.txt");

        byte[] buffer = new byte[1024];
        int bytesRead;

        while ((bytesRead = in.read(buffer)) != -1) {
            out.write(buffer, 0, bytesRead);
        }
    }
}
```

## Что может пойти не так при использовании с JPA?

- `@EqualsAndHashcode` может неверно отрабатывать, когда entity получает ID через БД. После сохранения в БД hashcode
  изменится
- Entity должен иметь public или protected конструктор без параметров. При использовании `@AllArgsConstructor` нужно
  также добавлять `@NoArgsConstrucror`
- `@EqualsAndHashcode` и `@ToString` по-умолчанию используют все поля класса. То есть они могут спровоцировать работу
  lazy-полей когда это не нужно (что скажется на производительности или вызовет exception если будет выполнено без
  транзакции). `@ToString` можно использовать как `@ToString.Exclude` над lazy-полями. А `@EqualsAndHashcode` и `@Data`
  лучше вообще не использовать в entity.